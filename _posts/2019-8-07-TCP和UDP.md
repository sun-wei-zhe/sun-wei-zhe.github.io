---
layout:     post
title:      浅谈 TCP & UDP
subtitle:   什么是三握四挥，TCP如何保证可靠性，粘包分包
date:       2019-08-07
author:     SWZ
header-img: img/post-bg-tcp_udp.jpg
catalog: true
tags:
    - 计算机网络
---

## 前言



---

## TCP（Transmission Control Protocol，传输控制协议）

TCP是一种**面向连接**、**可靠**的、**基于字节流**的传输层通信协议。每一条TCP连接只能有两个端点（endpoint），点对点（一对一）。TCP还提供了全双工服务，即可同时收和发，比如A和B打电话，A一直在讲话，如果B不回点什么的话A可能觉得线路断了，所以B会时不时“嗯”一下保持反馈。

### 三握四挥

其中TCP客户端主动发起TCP连接建立，握手需要在TCP客户端与服务器之间交换三个TCP报文段。

三握不多余，这是为了防止已经失效的连接请求报文段突然又传到了TCP服务器，因而导致错误。

TCP客户端会发送TCP连接释放报文段并进入终止等待1状态（FIN-WAIT-1），该报文段中的终止位FIN和确认位ACK的值都被设为1，表明这是一个TCP释放报文段，序号seq字段的值设置为u，它等于客户端已传送数据的最后一个字节的序号加1（注意TCP规定终止位FIN为1的报文段即使不携带数据也要消耗掉一个序号）。确认号ack字段的值设置为v，它等于客户端已收到数据的最后一个字节的序号加1。TCP服务端在收到TCP连接释放报文段后会发送一个普通的TCP确认报文段并进入关闭等待状态（CLOSE-WAIT）。此时，从TCP客户端到TCP服务端这个方向的连接就释放了，这时的TCP连接处于半关闭状态，但TCP服务端如果还有数据要发送TCP客户端仍要接收，也就是说从TCP服务端到TCP客户端这个方向的连接并未关闭。TCP客户单收到TCP确认报文段后就进入终止等待2状态（FIN-WAIT-2），等待TCP服务器发出的连接释放报文段。TCP服务器发送TCP连接释放报文段并进入最后确认状态（LAST-ACK）。TCP客户端收到TCP连接释放报文段后必须针对该报文段发送普通的TCP确认报文段，之后进入时间等待状态（TIME-WAIT），在经过2MSL（240s）才会进入关闭状态（CLOSED），该报文段首部的确认位ACK的值被设为1，表明这是一个普通的TCP确认报文段，序号seq字段的值被设置为u+1。TCP服务器收到该报文段后就进入关闭状态（CLOSED）。



### 如何保证传输可靠性



### 粘包&分包



### 流量控制、避免网络拥塞

滑动窗口

### timewait作用



### IO模型

Select/Poll

---

## UDP（User Datagram Protocol，用户数据报协议）

UDP是一种**无连接**的、**不可靠**的、但**传输效率较高**的通信协议。



---

## 总结

